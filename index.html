<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathe Aufgaben – Online Klassenspiel</title>
<style>
body { margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;background:#fafbfc;min-height:100vh;color:#222;}
.topbar {display:flex;align-items:center;gap:14px;margin:22px 0 10px 28px;font-size:1.1rem;font-weight:500;}
.punkte {background:#ffe066;color:#814c00;border-radius:12px;padding:7px 13px;font-weight:bold;font-size:1.19rem;letter-spacing:1px;min-width:52px;text-align:center;}
.name {color:#2274a5;font-weight:600;background:#e2ecf5;border-radius:10px;padding:6px 12px;font-size:1.08rem;}
.selector-bar {display:flex;flex-direction:column;gap:10px;align-items:center;margin:0 0 32px 0;}
.bereich-btn-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 6px;
}
.punkteanzeige {
  font-size: 1.09rem;
  font-weight: 500;
  color: #333;
  min-width: 56px;
  display: inline-block;
}
.selector-btn {font-size:1.28rem;padding:18px 36px;border-radius:39px;font-weight:700;border:none;min-width:320px;cursor:pointer;box-shadow:0 2px 12px #0002;transition:background .15s, box-shadow .15s, filter .15s, outline .15s, border .15s, transform .13s;display:flex;align-items:center;justify-content:center;background:#e0e0e0;color:#999;}
.selector-btn.active {background:#42bd46 !important;color:#fff !important;filter:brightness(0.96);outline:3px solid #fff;border:2px solid #328b35;box-shadow:0 6px 20px #0003;transform:scale(0.98);}
#aufgabenbereiche {margin:0 0 36px 0;width:100%;}
.aufgabenbereich{
  background:#fff;
  border-radius:24px;
  box-shadow:0 2px 16px #a1a1a111;
  padding:38px 16px 32px 16px;
  width:98vw;max-width:630px;
  margin:0 auto;
  min-height:350px;
  position:relative;
  z-index:2;
}
.kopfzeile{display:flex;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:2px;}
.kopfzeile .titel{font-size:2.1rem;font-weight:700;white-space:nowrap;}
.modi {
  display: flex;
  flex-direction: column;
  gap: 22px;
  align-items: center;
  margin: 34px 0 38px 0;
}
.modi button {
  min-width: 140px;
  min-height: 75px;
  padding: 0 22px;
  font-size: 1.6rem;
  font-weight: bold;
  border: none;
  border-radius: 44px;
  color: #fff;
  cursor: pointer;
  box-shadow: 0 4px 20px #0001;
  transition: filter .15s, background .14s;
  margin: 0;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  justify-content: center;
}
#btnNormal, #btnNormalSub, #btnNormalMul, #btnNormalDiv { background: #41b743; }
#btnMittel, #btnMittelSub, #btnMittelMul, #btnMittelDiv { background: #ffe249; color: #836c00; }
#btnSchwer, #btnSchwerSub, #btnSchwerMul, #btnSchwerDiv { background: #f15f5f; }
#btnNormal.selected, #btnNormal:active, #btnNormalSub.selected, #btnNormalSub:active, #btnNormalMul.selected, #btnNormalMul:active, #btnNormalDiv.selected, #btnNormalDiv:active { filter: brightness(0.93);}
#btnMittel.selected, #btnMittel:active, #btnMittelSub.selected, #btnMittelSub:active, #btnMittelMul.selected, #btnMittelMul:active, #btnMittelDiv.selected, #btnMittelDiv:active { filter: brightness(0.93);}
#btnSchwer.selected, #btnSchwer:active, #btnSchwerSub.selected, #btnSchwerSub:active, #btnSchwerMul.selected, #btnSchwerMul:active, #btnSchwerDiv.selected, #btnSchwerDiv:active { filter: brightness(0.93);}
#btnMittel, #btnMittelSub, #btnMittelMul, #btnMittelDiv { font-weight: 700; }
.aufgabe{font-size:1.33rem;margin:18px 0 14px 0;min-height:35px;font-weight:600;text-align:center;letter-spacing:1px;}
.loesungshinweis {color:#666;font-size:1.08rem;font-style:italic;text-align:center;margin-bottom:10px;margin-top:8px;}
.eingabe-box{display:flex;gap:10px;margin:8px 0 2px 0;justify-content:center;flex-wrap:wrap;}
.eingabe-box input[type="text"]{width:120px;font-size:1.2rem;border-radius:8px;border:1.5px solid #bbb;padding:5px 10px;text-align:center;outline:none;transition:border .17s;}
.eingabe-box button{background:#38b000;color:#fff;border:none;border-radius:8px;padding:7px 13px;font-size:1.05rem;font-weight:bold;cursor:pointer;transition:background .18s;}
.eingabe-box button:active{background:#217a00;}
.einheit-select{font-size:1.05rem;border:1.5px solid #bbb;border-radius:8px;padding:5px 8px;min-width:90px;}
.feedback{min-height:26px;font-size:1rem;font-weight:500;margin:6px 0;text-align:center;}
.hidden { display: none !important; }
.confetti-piece {position:fixed;width:10px;height:10px;border-radius:3px;opacity:0.85;z-index:1001;pointer-events:none;}
#reset-btn {
  margin: 26px 0 0 0;
  background: #ff5757;
  color: #fff;
  font-size: 1.15rem;
  font-weight: 700;
  border: none;
  border-radius: 16px;
  padding: 13px 36px;
  box-shadow: 0 4px 18px #d2222240;
  cursor: pointer;
  transition: background .14s, box-shadow .14s;
}
#reset-btn:active { background: #ba2323; }
@media(max-width:900px){
  .aufgabenbereich{min-height:300px;padding:25px 3vw;}
  .selector-btn{min-width:90vw;}
}
@media(max-width:600px){
  .aufgabenbereich{padding:16px 1vw;}
  .modi button{font-size:1.25rem;min-width:80vw;}
}
#lehrerpanel {
  display: none;
  max-width: 700px;
  margin: 44px auto;
  background: #fff;
  border-radius: 22px;
  box-shadow: 0 2px 14px #0001;
  padding: 35px 20px 28px 20px;
}
#lehrerpanel h2 { margin-top: 0; }
.schuelertabelle {
  width: 100%;
  border-collapse: collapse;
  margin-top: 18px;
  font-size: 1.07rem;
}
.schuelertabelle th, .schuelertabelle td {
  border: 1px solid #eee;
  padding: 6px 12px;
  text-align: center;
}
.schuelertabelle th { background: #f6f6f6; }
.schuelertabelle tr:nth-child(even) { background: #fcfcfc; }
.schuelertabelle td.namezelle { text-align:left;font-weight:600; }
@media(max-width:650px){
  #lehrerpanel{padding:15px 2vw;}
  .schuelertabelle{font-size:0.98rem;}
}
</style>
</head>
<body>
<div class="topbar">
  <span class="punkte" id="punkte">0</span>
  <span class="name" id="anzeigeName"></span>
</div>

<!-- Lehrer-Übersicht -->
<div id="lehrerpanel">
  <h2>Lehrer-Übersicht: Schüler-Ergebnisse</h2>
  <table class="schuelertabelle" id="schuelertabelle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Gesamt</th>
        <th>Addition</th>
        <th>Subtraktion</th>
        <th>Multiplikation</th>
        <th>Division</th>
      </tr>
    </thead>
    <tbody id="schuelerliste">
      <!-- Wird per JS befüllt -->
    </tbody>
  </table>
  <button id="reset-btn" onclick="resetAllData()">Alle Ergebnisse löschen</button>
  <div style="color:#666;font-size:0.97rem;margin-top:18px;">
    <b>Tipp:</b> Diese Übersicht zeigt alle Schüler, die sich auf dem Server eingetragen haben.<br>
    Für Datenschutz bitte keine Klarnamen verwenden.
  </div>
</div>

<!-- Aufgabenwahl mit Bereichs-Punkten -->
<div class="selector-bar">
  <div class="bereich-btn-wrap">
    <button type="button" class="selector-btn add" onclick="toggleArea('add')">Additionsaufgaben</button>
    <span class="punkteanzeige" id="punkteAdd">(0/3)</span>
  </div>
  <div class="bereich-btn-wrap">
    <button type="button" class="selector-btn sub" onclick="toggleArea('sub')">Subtraktionsaufgaben</button>
    <span class="punkteanzeige" id="punkteSub">(0/3)</span>
  </div>
  <div class="bereich-btn-wrap">
    <button type="button" class="selector-btn mul" onclick="toggleArea('mul')">Multiplikationsaufgaben</button>
    <span class="punkteanzeige" id="punkteMul">(0/3)</span>
  </div>
  <div class="bereich-btn-wrap">
    <button type="button" class="selector-btn divi" onclick="toggleArea('div')">Divisionsaufgaben</button>
    <span class="punkteanzeige" id="punkteDiv">(0/3)</span>
  </div>
</div>

<div id="aufgabenbereiche">
  <div id="spielscreen-add" class="hidden">
    <div class="aufgabenbereich">
      <div class="kopfzeile"><span class="titel">Addition</span></div>
      <div class="modi">
        <button type="button" onclick="zeigeAufgabe('normal')" id="btnNormal">Normal</button>
        <button type="button" onclick="zeigeAufgabe('mittel')" id="btnMittel">Mittel</button>
        <button type="button" onclick="zeigeAufgabe('schwer')" id="btnSchwer">Schwer</button>
      </div>
      <div class="aufgabe" id="aufgabe"></div>
      <div class="loesungshinweis" id="hinweisAdd" style="display:none;">
        rechne SCHRIFTLICH in deinem Heft und trage die Lösung hier ein
      </div>
      <div class="eingabe-box hidden" id="eingabeBox">
        <input type="text" id="loesung" placeholder="Antwort" autocomplete="off">
        <select id="einheit" class="einheit-select hidden"></select>
        <button type="button" onclick="pruefeLoesung()">OK</button>
      </div>
      <div class="feedback" id="feedback"></div>
    </div>
  </div>
  <div id="spielscreen-sub" class="hidden">
    <div class="aufgabenbereich">
      <div class="kopfzeile"><span class="titel">Subtraktion</span></div>
      <div class="modi">
        <button type="button" onclick="zeigeAufgabe('normal','sub')" id="btnNormalSub">Normal</button>
        <button type="button" onclick="zeigeAufgabe('mittel','sub')" id="btnMittelSub">Mittel</button>
        <button type="button" onclick="zeigeAufgabe('schwer','sub')" id="btnSchwerSub">Schwer</button>
      </div>
      <div class="aufgabe" id="aufgabeSub"></div>
      <div class="loesungshinweis" id="hinweisSub" style="display:none;">
        rechne SCHRIFTLICH in deinem Heft und trage die Lösung hier ein
      </div>
      <div class="eingabe-box hidden" id="eingabeBoxSub">
        <input type="text" id="loesungSub" placeholder="Antwort" autocomplete="off">
        <select id="einheitSub" class="einheit-select hidden"></select>
        <button type="button" onclick="pruefeLoesung('sub')">OK</button>
      </div>
      <div class="feedback" id="feedbackSub"></div>
    </div>
  </div>
  <div id="spielscreen-mul" class="hidden">
    <div class="aufgabenbereich">
      <div class="kopfzeile"><span class="titel">Multiplikation</span></div>
      <div class="modi">
        <button type="button" onclick="zeigeAufgabe('normal','mul')" id="btnNormalMul">Normal</button>
        <button type="button" onclick="zeigeAufgabe('mittel','mul')" id="btnMittelMul">Mittel</button>
        <button type="button" onclick="zeigeAufgabe('schwer','mul')" id="btnSchwerMul">Schwer</button>
      </div>
      <div class="aufgabe" id="aufgabeMul"></div>
      <div class="loesungshinweis" id="hinweisMul" style="display:none;">
        rechne SCHRIFTLICH in deinem Heft und trage die Lösung hier ein
      </div>
      <div class="eingabe-box hidden" id="eingabeBoxMul">
        <input type="text" id="loesungMul" placeholder="Antwort" autocomplete="off">
        <select id="einheitMul" class="einheit-select hidden"></select>
        <button type="button" onclick="pruefeLoesung('mul')">OK</button>
      </div>
      <div class="feedback" id="feedbackMul"></div>
    </div>
  </div>
  <div id="spielscreen-div" class="hidden">
    <div class="aufgabenbereich">
      <div class="kopfzeile"><span class="titel">Division</span></div>
      <div class="modi">
        <button type="button" onclick="zeigeAufgabe('normal','div')" id="btnNormalDiv">Normal</button>
        <button type="button" onclick="zeigeAufgabe('mittel','div')" id="btnMittelDiv">Mittel</button>
        <button type="button" onclick="zeigeAufgabe('schwer','div')" id="btnSchwerDiv">Schwer</button>
      </div>
      <div class="aufgabe" id="aufgabeDiv"></div>
      <div class="loesungshinweis" id="hinweisDiv" style="display:none;">
        rechne SCHRIFTLICH in deinem Heft und trage die Lösung hier ein
      </div>
      <div class="eingabe-box hidden" id="eingabeBoxDiv">
        <input type="text" id="loesungDiv" placeholder="Antwort" autocomplete="off">
        <select id="einheitDiv" class="einheit-select hidden"></select>
        <button type="button" onclick="pruefeLoesung('div')">OK</button>
      </div>
      <div class="feedback" id="feedbackDiv"></div>
    </div>
  </div>
</div>
<!-- Startscreen Modal -->
<div id="startscreen" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:2222;background:#fafbfc;display:flex;align-items:center;justify-content:center;">
  <form class="startfeld" id="startform">
    <input id="name" type="text" maxlength="25" required autocomplete="off" placeholder="Dein Name">
    <button type="submit">Weiter</button>
  </form>
</div>
<script>
const SERVER_URL = "https://grundrechenarten-server.onrender.com"; // <--- DEINE SERVER-URL!

const aufgaben = {
  add: {
    normal: { aufgabe: '19.010 + 1.938 = ?', lösung: '20948' },
    mittel: { aufgabe: '199.082 + 1.921 + 8 = ?', lösung: '201011' },
    schwer: { aufgabe: 'Thomas bekommt zum Geburtstag von Oma 1.141 €, von Opa 9.149,39 € und von Sabine 1.191,30 €.<br>Berechne, wie viel Geld er bekommt.', lösung: '11481,69', einheit: true }
  },
  sub: {
    normal: { aufgabe: '5.782 - 791 = ?', lösung: '4991' },
    mittel: { aufgabe: '10.000 - 9.345 - 32 = ?', lösung: '623' },
    schwer: { aufgabe: 'Maria hat 9.500 €. Sie kauft ein Fahrrad für 2.349,99 € und eine Uhr für 1.899,05 €. Wie viel Geld hat sie noch?', lösung: '5250,96', einheit: true }
  },
  mul: {
    normal: { aufgabe: '205 × 15 = ?', lösung: '3075' },
    mittel: { aufgabe: '2058 × 701 = ?', lösung: '1442658' },
    schwer: { aufgabe: 'An der IGS Kandel gibt es Fünfhundertundsiebenundzwanzig Schüler.<br>Beim Spendenlauf spendet jeder Schüler durchschnittlich Achtundzwanzig Euro.<br>Wie viel Geld kommt insgesamt zusammen?', lösung: '14756' }
  },
  div: {
    normal: { aufgabe: '768 : 6 = ?', lösung: '128' },
    mittel: { aufgabe: '12.090 : 6 = ?', lösung: '2015' },
    schwer: { aufgabe: 'Beim Spendenlauf der IGS Wörth wurden insgesamt Viertausendsiebenhundertdreiundvierzig Kilometer gelaufen.<br>Jeder Schüler lief im Durchschnitt Neun Kilometer.<br>Wie viele Schüler sind mitgelaufen?', lösung: '527' }
  }
};
const levelMap = {normal:1, mittel:2, schwer:3};
const punkteMap = {normal:1, mittel:2, schwer:3};

let userName = '';
let aktuellerBereich = '';
let aktuellerModus = '';

// SERVER-KOMMUNIKATION -----------------
async function saveMaxLevels(name, obj){
  await fetch(SERVER_URL + "/save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, maxlevels: obj })
  });
}
async function loadMaxLevels(name){
  const list = await fetch(SERVER_URL + "/list").then(r=>r.json());
  const sch = list.find(e=>e.name===name);
  return sch ? {add:sch.add, sub:sch.sub, mul:sch.mul, div:sch.div} : {add:0,sub:0,mul:0,div:0};
}
async function ladePunkte(name){
  const maxl = await loadMaxLevels(name);
  return (maxl.add||0)+(maxl.sub||0)+(maxl.mul||0)+(maxl.div||0);
}
async function ladeAlleSchueler(){
  return await fetch(SERVER_URL + "/list").then(r=>r.json());
}
async function resetAllData(){
  if(confirm('Alle gespeicherten Schüler-Ergebnisse auf dem Server unwiderruflich löschen?\n\nDas betrifft alle Namen und Punktestände!')){
    await fetch(SERVER_URL + "/reset", { method: "POST" });
    showLehrerPanel();
    alert('Alle Schüler-Ergebnisse wurden gelöscht.');
  }
}
// --------------------------------------

// Neue Funktion für Bereichsanzeige!
async function updateBereichPunkte() {
  const maxl = await loadMaxLevels(userName);
  document.getElementById('punkteAdd').textContent = `(${maxl.add||0}/3)`;
  document.getElementById('punkteSub').textContent = `(${maxl.sub||0}/3)`;
  document.getElementById('punkteMul').textContent = `(${maxl.mul||0}/3)`;
  document.getElementById('punkteDiv').textContent = `(${maxl.div||0}/3)`;
}

function toggleArea(area) {
  const screens = ['add','sub','mul','div'];
  if (aktuellerBereich === area) {
    aktuellerBereich = '';
    screens.forEach(s => document.getElementById('spielscreen-'+s).classList.add('hidden'));
    document.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
    return;
  }
  aktuellerBereich = area;
  screens.forEach(s => document.getElementById('spielscreen-'+s).classList.toggle('hidden', s !== area));
  document.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
  if(area === 'add') document.querySelector('.selector-btn.add').classList.add('active');
  if(area === 'sub') document.querySelector('.selector-btn.sub').classList.add('active');
  if(area === 'mul') document.querySelector('.selector-btn.mul').classList.add('active');
  if(area === 'div') document.querySelector('.selector-btn.divi').classList.add('active');
  document.getElementById('anzeigeName').textContent = userName;
  ladePunkte(userName).then(p=>document.getElementById('punkte').textContent = p);
}

function zeigeAufgabe(modus, bereich){
  aktuellerModus = modus;
  bereich = bereich || 'add';
  let boxId = {add:'eingabeBox', sub:'eingabeBoxSub', mul:'eingabeBoxMul', div:'eingabeBoxDiv'}[bereich];
  let aufgabeDivId = {add:'aufgabe', sub:'aufgabeSub', mul:'aufgabeMul', div:'aufgabeDiv'}[bereich];
  let einheitSelId = {add:'einheit', sub:'einheitSub', mul:'einheitMul', div:'einheitDiv'}[bereich];
  let feedbackId = {add:'feedback', sub:'feedbackSub', mul:'feedbackMul', div:'feedbackDiv'}[bereich];
  let hinweisId = {add:'hinweisAdd', sub:'hinweisSub', mul:'hinweisMul', div:'hinweisDiv'}[bereich];
  let loesungId = {add:'loesung', sub:'loesungSub', mul:'loesungMul', div:'loesungDiv'}[bereich];

  let box = document.getElementById(boxId);
  let aufgabeDiv = document.getElementById(aufgabeDivId);
  let einheitSel = document.getElementById(einheitSelId);
  let feedback = document.getElementById(feedbackId);
  let hinweis = document.getElementById(hinweisId);
  box.classList.remove('hidden');
  hinweis.style.display = "block";
  feedback.textContent = '';
  document.getElementById(loesungId).value = '';
  if(aufgaben[bereich][modus].einheit){
    einheitSel.classList.remove('hidden');
    const units=['€','kg','m','g','km','l','cm'];
    shuffle(units);
    einheitSel.innerHTML='<option value="" disabled selected hidden>bitte wählen…</option>';
    units.forEach(u=>{einheitSel.innerHTML+=`<option value="${u}">${u}</option>`;});
  }else{
    einheitSel.classList.add('hidden');
  }
  aufgabeDiv.innerHTML = aufgaben[bereich][modus].aufgabe;
  ['btnNormal','btnMittel','btnSchwer'].forEach(id=>{
    let btn = document.getElementById(id + (bereich==='add'?'':bereich.charAt(0).toUpperCase()+bereich.slice(1)));
    if(btn) btn.classList.remove('selected');
  });
  let btnId = 'btn'+modus.charAt(0).toUpperCase()+modus.slice(1)+(bereich==='add'?'':bereich.charAt(0).toUpperCase()+bereich.slice(1));
  let btn = document.getElementById(btnId);
  if(btn) btn.classList.add('selected');
  box.dataset.mode = modus;
  box.dataset.bereich = bereich;
  document.getElementById(loesungId).focus();
}
function normalize(val) {
  return val.replace(/\./g, '').replace(/ /g, '').replace(/,/g,',').toLowerCase();
}
async function pruefeLoesung(bereich){
  bereich = bereich || 'add';
  let boxId = {add:'eingabeBox', sub:'eingabeBoxSub', mul:'eingabeBoxMul', div:'eingabeBoxDiv'}[bereich];
  let feedbackId = {add:'feedback', sub:'feedbackSub', mul:'feedbackMul', div:'feedbackDiv'}[bereich];
  let einheitSelId = {add:'einheit', sub:'einheitSub', mul:'einheitMul', div:'einheitDiv'}[bereich];
  let loesungId = {add:'loesung', sub:'loesungSub', mul:'loesungMul', div:'loesungDiv'}[bereich];
  let box = document.getElementById(boxId);
  let modus = box.dataset.mode;
  let feedback = document.getElementById(feedbackId);
  let einheitOk = true;
  let einheit = '';
  let eing = normalize(document.getElementById(loesungId).value);
  if(aufgaben[bereich][modus].einheit){
    einheit = document.getElementById(einheitSelId).value;
    einheitOk = (einheit==="€");
  }
  let korrekt = false, level = levelMap[modus], punkte = punkteMap[modus];
  let loesung = aufgaben[bereich][modus].lösung;
  if(Array.isArray(loesung)){
    korrekt = loesung.map(l=>normalize(l)).includes(eing) && einheitOk;
  }else{
    // Zulasse mit und ohne Punkt
    korrekt = (normalize(loesung) === eing || normalize(loesung).replace(/,/g,'.') === eing.replace(/,/g,'.')) && einheitOk;
  }
  if(korrekt){
    // Punkte für diese Rechenart updaten (nur der höchste zählt!)
    let maxlevels = await loadMaxLevels(userName);
    if(level > (maxlevels[bereich]||0)){
      maxlevels[bereich] = level;
      await saveMaxLevels(userName,maxlevels);
      let punkte = await ladePunkte(userName);
      document.getElementById('punkte').textContent = punkte;
      await updateBereichPunkte();
      feedback.textContent = `✅ Richtig! Jetzt ${punkte} Punkt${punkte>1?'e':''} insgesamt.`;
      konfetti();
    }else{
      feedback.textContent = '✅ Schon gelöst! Dein Highscore bleibt erhalten.';
    }
  }else{
    feedback.textContent = '❌ Leider falsch!';
  }
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
async function showLehrerPanel(){
  document.getElementById('lehrerpanel').style.display = 'block';
  document.querySelector('.selector-bar').style.display='none';
  document.getElementById('aufgabenbereiche').style.display='none';
  document.getElementById('punkte').style.display='none';
  document.getElementById('anzeigeName').textContent = "Lehrer";
  const schueler = await ladeAlleSchueler();
  let html = '';
  schueler.sort((a,b)=>(b.ges)-(a.ges));
  for(let s of schueler){
    html += `<tr>
      <td class="namezelle">${s.name}</td>
      <td>${s.ges}</td>
      <td>${s.add||0}</td>
      <td>${s.sub||0}</td>
      <td>${s.mul||0}</td>
      <td>${s.div||0}</td>
    </tr>`;
  }
  if(!html) html = `<tr><td colspan="6" style="color:#888;text-align:center;">Noch keine Ergebnisse erfasst</td></tr>`;
  document.getElementById('schuelerliste').innerHTML = html;
}
// --- STARTSCREEN LOGIK ---
document.getElementById('startform').addEventListener('submit',async e=>{
  e.preventDefault();
  userName = document.getElementById('name').value.trim();
  if(!userName){document.getElementById('name').focus();return;}
  localStorage.setItem('letzterName',userName);
  document.getElementById('anzeigeName').textContent = userName;
  let punkte = await ladePunkte(userName);
  document.getElementById('punkte').textContent = punkte;
  document.getElementById('startscreen').style.display='none';
  // --- LEHRERMODUS ---
  if(userName.toLowerCase() === 'ericschumacher'){
    showLehrerPanel();
    return;
  }
  document.getElementById('lehrerpanel').style.display = 'none';
  document.querySelector('.selector-bar').style.display='';
  document.getElementById('aufgabenbereiche').style.display='';
  document.getElementById('punkte').style.display='';
  ['add','sub','mul','div'].forEach(s => document.getElementById('spielscreen-'+s).classList.add('hidden'));
  document.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
  await updateBereichPunkte();
});
window.onload=function(){
  const n=document.getElementById('name');
  if(localStorage.getItem('letzterName')&&n.value.trim()==='')n.value=localStorage.getItem('letzterName');
  ['add','sub','mul','div'].forEach(s => document.getElementById('spielscreen-'+s).classList.add('hidden'));
  document.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById('lehrerpanel').style.display = 'none';
  document.querySelector('.selector-bar').style.display='';
  document.getElementById('aufgabenbereiche').style.display='';
  document.getElementById('punkte').style.display='';
};
document.getElementById('name').addEventListener('input',function(){
  localStorage.setItem('letzterName',this.value.trim());
});
function konfetti(){
  const colors = ["#ffec44","#ff5757","#42bd46","#3391ff","#ffb347","#e84393","#9b59b6","#f9d90b"];
  for(let i=0;i<30;i++){
    let div=document.createElement("div");
    div.className="confetti-piece";
    const midX = 40 + Math.random()*20;
    div.style.left = midX + "vw";
    div.style.top = "44vh";
    div.style.opacity = Math.random()*0.4+0.6;
    let rotate = Math.random()*360;
    let dx = Math.random()*120-60;
    let dy = Math.random()*90-40;
    div.style.background=colors[Math.floor(Math.random()*colors.length)];
    div.style.transform = `rotate(${rotate}deg)`;
    document.body.appendChild(div);
    setTimeout(()=>{
      div.style.transition="all 1.1s cubic-bezier(.4,1.02,.46,.9)";
      div.style.left = `calc(${midX}vw + ${dx}px)`;
      div.style.top = `calc(44vh + ${dy}px)`;
      div.style.opacity = 0.2+Math.random()*0.7;
      div.style.transform = `rotate(${rotate+90+Math.random()*90}deg)`;
    },30);
    setTimeout(()=>div.remove(),1350+Math.random()*100);
  }
}
</script>
</body>
</html>
